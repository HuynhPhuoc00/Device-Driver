# ============================================================================
# PROJECT STRUCTURE
# ============================================================================

# PROJECT STRUCTURE 
DRV_DIRS = /home/phuoc/Doc/project/drv/lcd \
			/home/phuoc/Doc/project/drv/sht30
APP_DIR = /home/phuoc/Doc/project/app
DTBO_DIR = /home/phuoc/Doc/project/dts

# ============================================================================
# TARGET STRUCTURE
# ============================================================================

# TARGET STRUCTURE 
DEBIAN_FOLDER = /home/debian/drivers/
DTS_DIR         := ../dts/

# Device tree paths
DTB_FILE        := $(PWD)/../source/linux/arch/arm/boot/dts/am335x-boneblack.dtb

all:
	@echo "==========================================================================="
	@echo "Building driver..."
	@echo "==========================================================================="

	@for dir in $(DRV_DIRS); do \
		echo "Building driver in $$dir"; \
		make -C $$dir all || exit 1; \
	done

	@echo "==========================================================================="
	@echo "Building application..."
	@echo "==========================================================================="

	make -C $(APP_DIR) all
	
	@echo "==========================================================================="
	@echo "Building DTBO..."
	@echo "==========================================================================="
	
	make -C $(DTBO_DIR) all
	
	@echo "==========================================================================="
	@echo "Build completed successfully!"
	@echo "==========================================================================="

target:
	@echo "==========================================================================="
	@echo "Building target..."
	@echo "==========================================================================="

	make -C $(DRV_DIR) all

	@echo "==========================================================================="
	@echo "Build completed successfully!"
	@echo "==========================================================================="

elf:
	@echo "==========================================================================="
	@echo "Building App..."
	@echo "==========================================================================="

	make -C $(APP_DIR) all
	
	@echo "==========================================================================="
	@echo "Build completed successfully!"
	@echo "==========================================================================="

dtbo:
	@echo "==========================================================================="
	@echo "Building DTBO..."
	@echo "==========================================================================="
	
	make -C $(DTBO_DIR) all
	
	@echo "==========================================================================="
	@echo "Build completed successfully!"
	@echo "==========================================================================="


# Copy to board
copy-dtb:
	scp $(DTB_FILE) debian@192.168.137.2:$(DEBIAN_FOLDER)
copy-dtbo:
	scp $(DTBO_DIR)/*.dtbo debian@192.168.137.2:$(DEBIAN_FOLDER)
copy-drv:
	scp $(DRV_DIR)/*.ko $(APP_DIR)/*.elf debian@192.168.137.2:$(DEBIAN_FOLDER)

clean:
	@echo "==========================================================================="
	@echo "Cleaning driver..."
	@echo "==========================================================================="
	
	@for dir in $(DRV_DIRS); do \
		echo "Building driver in $$dir"; \
		make -C $$dir clean || exit 1; \
	done

	@echo "==========================================================================="
	@echo "Cleaning application..."
	@echo "==========================================================================="

	-make -C $(APP_DIR) clean

	@echo "==========================================================================="
	@echo "Cleaning application..."
	@echo "==========================================================================="

	-make -C $(DTBO_DIR) clean

	@echo "==========================================================================="
	@echo "Cleaning  completed successfully!"
	@echo "==========================================================================="